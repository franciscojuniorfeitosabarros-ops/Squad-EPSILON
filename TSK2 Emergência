const readline = require("readline");

// =============== LINKED LIST (ProntuÃ¡rio) =============== //
class ConsultationNode {
    constructor(date, time, doctor, diagnosis) {
        this.date = date;
        this.time = time;
        this.doctor = doctor;
        this.diagnosis = diagnosis;
        this.next = null;
    }
}

class MedicalHistory {
    constructor() {
        this.head = null;
    }

    addConsultation(date, time, doctor, diagnosis) {
        const newNode = new ConsultationNode(date, time, doctor, diagnosis);

        if (!this.head) {
            this.head = newNode;
            return;
        }

        let current = this.head;
        while (current.next) {
            current = current.next;
        }

        current.next = newNode;
    }

    printHistory() {
        if (!this.head) {
            console.log("\nâš  Nenhuma consulta cadastrada.");
            return;
        }

        console.log("\n HISTÃ“RICO MÃ‰DICO DO PACIENTE:");

        let current = this.head;
        let count = 1;

        while (current) {
            console.log(\nConsulta #${count});
            console.log( Data: ${current.date});
            console.log( Hora: ${current.time});
            console.log( MÃ©dico: ${current.doctor});
            console.log( DiagnÃ³stico: ${current.diagnosis});

            current = current.next;
            count++;
        }
    }

    clearHistory() {
        this.head = null;
        console.log("\nðŸ—‘ HistÃ³rico apagado com sucesso!");
    }
}

// =============== FILA DE EMERGÃŠNCIA (FIFO) =============== //
class EmergencyQueue {
    constructor() {
        this.queue = [];
    }

    enqueue(patient) {
        this.queue.push(patient);
    }

    dequeue() {
        return this.queue.shift();
    }

    showQueue() {
        if (this.queue.length === 0) {
            console.log("\n Nenhum paciente aguardando.");
            return;
        }

        console.log("\n PACIENTES NA FILA:");
        this.queue.forEach((p, i) => {
            console.log(${i + 1}. ${p});
        });
    }
}

// InstÃ¢ncias
const history = new MedicalHistory();
const emergency = new EmergencyQueue();

const rl = readline.createInterface({
    input: process.stdin,
    output: process.stdout
});

// ============================= MENU ============================= //
function menu() {
    console.log(`
=============== SISTEMA HIS ===============

 PRONTUÃRIO
1 - Adicionar consulta ao prontuÃ¡rio
2 - Mostrar histÃ³rico do paciente
3 - Apagar todo o histÃ³rico do paciente

 EMERGÃŠNCIA
4 - Adicionar paciente Ã  emergÃªncia
5 - Atender prÃ³ximo paciente
6 - Mostrar fila da emergÃªncia

0 - Sair
===========================================
`);

    rl.question("Escolha uma opÃ§Ã£o: ", (op) => {
        switch (op) {

            // ======= PRONTUÃRIO ======= //

            case "1":
                rl.question("Data (DD-MM-YYYY): ", (date) => {
                    rl.question("Hora (HH:MM): ", (time) => {
                        rl.question("MÃ©dico: ", (doctor) => {
                            rl.question("DiagnÃ³stico: ", (diagnosis) => {
                                history.addConsultation(date, time, doctor, diagnosis);
                                console.log("\n Consulta adicionada!");
                                menu();
                            });
                        });
                    });
                });
                break;

            case "2":
                history.printHistory();
                menu();
                break;

            case "3":
                history.clearHistory();
                menu();
                break;

            // ======= EMERGÃŠNCIA ======= //

            case "4":
                rl.question("Nome do paciente: ", (name) => {
                    if (name.trim() === "") {
                        console.log("\nâš  Nome invÃ¡lido.");
                    } else {
                        emergency.enqueue(name);
                        console.log(\nðŸš‘ Paciente "${name}" adicionado Ã  fila!);
                    }
                    menu();
                });
                break;

            case "5":
                const next = emergency.dequeue();
                if (!next) {
                    console.log("\nâš  Nenhum paciente para atender.");
                } else {
                    console.log(\n Chamando paciente: ${next});
                }
                menu();
                break;

            case "6":
                emergency.showQueue();
                menu();
                break;

            // ======= SAIR ======= //

            case "0":
                console.log("\n Encerrando...");
                rl.close();
                break;

            default:
                console.log("\n OpÃ§Ã£o invÃ¡lida.");
                menu();
                break;
        }
    });
}

menu();

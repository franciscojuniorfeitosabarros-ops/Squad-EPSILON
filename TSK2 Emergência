const readline = require("readline");

// =============== LINKED LIST (Prontu√°rio) =============== //
class ConsultationNode {
    constructor(date, time, doctor, diagnosis) {
        this.date = date;
        this.time = time;
        this.doctor = doctor;
        this.diagnosis = diagnosis;
        this.next = null;
    }
}

class MedicalHistory {
    constructor() {
        this.head = null;
    }

    addConsultation(date, time, doctor, diagnosis) {
        const newNode = new ConsultationNode(date, time, doctor, diagnosis);

        if (!this.head) {
            this.head = newNode;
            return;
        }

        let current = this.head;
        while (current.next) {
            current = current.next;
        }

        current.next = newNode;
    }

    printHistory() {
        if (!this.head) {
            console.log("\n‚ö† Nenhuma consulta cadastrada.");
            return;
        }

        console.log("\nüìò HIST√ìRICO M√âDICO DO PACIENTE:");

        let current = this.head;
        let count = 1;

        while (current) {
            console.log(\nConsulta #${count});
            console.log(üìÖ Data: ${current.date});
            console.log(‚è∞ Hora: ${current.time});
            console.log(üë®‚Äç‚öï M√©dico: ${current.doctor});
            console.log(üìù Diagn√≥stico: ${current.diagnosis});

            current = current.next;
            count++;
        }
    }

    clearHistory() {
        this.head = null;
        console.log("\nüóë Hist√≥rico apagado com sucesso!");
    }
}

// =============== FILA DE EMERG√äNCIA (FIFO) =============== //
class EmergencyQueue {
    constructor() {
        this.queue = [];
    }

    enqueue(patient) {
        this.queue.push(patient);
    }

    dequeue() {
        return this.queue.shift();
    }

    showQueue() {
        if (this.queue.length === 0) {
            console.log("\nüè• Nenhum paciente aguardando.");
            return;
        }

        console.log("\nüöë PACIENTES NA FILA:");
        this.queue.forEach((p, i) => {
            console.log(${i + 1}. ${p});
        });
    }
}

// Inst√¢ncias
const history = new MedicalHistory();
const emergency = new EmergencyQueue();

const rl = readline.createInterface({
    input: process.stdin,
    output: process.stdout
});

// ============================= MENU ============================= //
function menu() {
    console.log(`
=============== SISTEMA HIS ===============

üìò PRONTU√ÅRIO
1 - Adicionar consulta ao prontu√°rio
2 - Mostrar hist√≥rico do paciente
3 - Apagar todo o hist√≥rico do paciente

üöë EMERG√äNCIA
4 - Adicionar paciente √† emerg√™ncia
5 - Atender pr√≥ximo paciente
6 - Mostrar fila da emerg√™ncia

0 - Sair
===========================================
`);

    rl.question("Escolha uma op√ß√£o: ", (op) => {
        switch (op) {

            // ======= PRONTU√ÅRIO ======= //

            case "1":
                rl.question("Data (DD-MM-YYYY): ", (date) => {
                    rl.question("Hora (HH:MM): ", (time) => {
                        rl.question("M√©dico: ", (doctor) => {
                            rl.question("Diagn√≥stico: ", (diagnosis) => {
                                history.addConsultation(date, time, doctor, diagnosis);
                                console.log("\n‚úÖ Consulta adicionada!");
                                menu();
                            });
                        });
                    });
                });
                break;

            case "2":
                history.printHistory();
                menu();
                break;

            case "3":
                history.clearHistory();
                menu();
                break;

            // ======= EMERG√äNCIA ======= //

            case "4":
                rl.question("Nome do paciente: ", (name) => {
                    if (name.trim() === "") {
                        console.log("\n‚ö† Nome inv√°lido.");
                    } else {
                        emergency.enqueue(name);
                        console.log(\nüöë Paciente "${name}" adicionado √† fila!);
                    }
                    menu();
                });
                break;

            case "5":
                const next = emergency.dequeue();
                if (!next) {
                    console.log("\n‚ö† Nenhum paciente para atender.");
                } else {
                    console.log(\nü©∫ Chamando paciente: ${next});
                }
                menu();
                break;

            case "6":
                emergency.showQueue();
                menu();
                break;

            // ======= SAIR ======= //

            case "0":
                console.log("\nüëã Encerrando...");
                rl.close();
                break;

            default:
                console.log("\n‚ùå Op√ß√£o inv√°lida.");
                menu();
                break;
        }
    });
}

menu();
